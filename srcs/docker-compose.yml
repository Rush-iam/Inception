version: "3.9"

services:
  nginx:
      build: requirements/nginx/
      volumes:
          - wordpress:/var/www/html
      ports:
          - "443:443"
      restart: always
  mariadb:
      build:
          context: requirements/mariadb/
          args:
              - MYSQL_ROOT_PASSWORD
              - MYSQL_USER
              - MYSQL_PASSWORD
              - WP_DB_NAME
      volumes:
          - db:/var/lib/mysql
      restart: always
  wordpress:
      depends_on:
          - nginx
          - mariadb
      build:
          context: requirements/wordpress/
          args:
              - DOMAIN_NAME
              - MYSQL_USER
              - MYSQL_PASSWORD
              - WP_DB_HOST=mariadb 
              - WP_DB_NAME
              - WP_SITE_TITLE
              - WP_ADMIN_LOGIN
              - WP_ADMIN_PASSWORD
              - WP_ADMIN_EMAIL
              - WP_USER_LOGIN
              - WP_USER_PASSWORD
              - WP_USER_EMAIL
      volumes:
          - wordpress:/wordpress
      restart: always

volumes:
    wordpress:
        driver_opts:
            type: none
            device: /Users/ngragas/data/wordpress
            o: bind
    db:
        driver_opts:
            type: none
            device: /Users/ngragas/data/db
            o: bind


      #  mariadb:
      #    image: mysql:5.7
      #    volumes:
      #      - db_data:/var/lib/mysql
      #    restart: always
      #    environment:
      #      MYSQL_ROOT_PASSWORD: somewordpress
      #      MYSQL_DATABASE: wordpress
      #      MYSQL_USER: wordpress
      #      MYSQL_PASSWORD: wordpress
    
      #  wordpress:
      #    depends_on:
      #      - db
      #    image: wordpress:latest
      #    volumes:
      #      - wordpress_data:/var/www/html
      #    ports:
      #      - "8000:80"
      #    restart: always
      #    environment:
      #      WORDPRESS_DB_HOST: db:3306
      #      WORDPRESS_DB_USER: wordpress
      #      WORDPRESS_DB_PASSWORD: wordpress
      #      WORDPRESS_DB_NAME: wordpress
      #volumes:
      #  db_data: {}
      #  wordpress_data: {}
